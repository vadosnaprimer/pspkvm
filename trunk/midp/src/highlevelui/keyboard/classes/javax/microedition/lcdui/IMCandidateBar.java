package javax.microedition.lcdui;

class IMCandidateBar {
    static CNLib cnlib;
    static Image IMimage;
    String pinyin = "";
    int cur_pos = 0;
    int cur_sel = 0;
    char[] cur_candidates = new char[5];

    public IMCandidateBar(int width, int height) {
    }

    private int getCandidateChars(String py, int pos , int num) {
    	int n = 0;
    	char[] cnchars;
    	
    	System.out.println("getCandidateChars: "+py);
    	int total = cnlib.getNumOfChineseCharacters(py);
    	System.out.println("getCandidateChars: total "+ total + " chars");
    	if (total <= pos) {
    		return 0;
    	} else if (pos + num > total) {
    	       cnchars = cnlib.parse(py, pos, total - pos);
    	} else {
    		cnchars = cnlib.parse(py, pos, num);
    	}
    	
    	for (int i = 0; i < num; i++) {
    	    if (pos + i >= total) {
    	        cur_candidates[i] = 0;
    	    } else {
    	        cur_candidates[i] = cnchars[i];
    	        n++;
    	    }
    	}
    	System.out.println("getCandidateChars: "+n+ "chars added");
    	
    	return n;
    }
    
    public void keyPressed(char c) {
    	if (c >= 'a' && c <= 'z') {
    	    getCandidateChars(pinyin + c, 0, 5);
    	    pinyin = pinyin + c;
           cur_pos = 0;
           cur_sel = 0;
    	}
    }

    public void backspace() {
    	int len = pinyin.length();
    	if (len > 0) {
    	    pinyin = pinyin.substring(0, len - 1);
    	    getCandidateChars(pinyin, 0, 5);    	    
           cur_pos = 0;
           cur_sel = 0;
    	}
    }

    public void paint(Graphics g, int width, int height) {
    	int offset = (width - 90) / 5;
    	int x = 80;
    	g.drawImage(IMimage, 0, 5, Graphics.TOP+Graphics.LEFT);
    	g.drawString(pinyin, 20, 0, Graphics.TOP+Graphics.LEFT);
    	for (int pos = 0; pos < 5; pos++) {
    	    if (cur_candidates[pos] == 0) break;
    	    if (pos == cur_sel) {
    	    	g.setColor(0x88, 0x88, 0);
    	    } else {
    	       g.setColor(0x6699ff);
    	    }    	    
    	    g.fillRect(x, 0, 20, 25);
    	    g.setColor(0x0);
    	    g.drawChar(cur_candidates[pos], x, 0, Graphics.TOP+Graphics.LEFT);
    	    x+=offset;
    	}
    }

    public void prevPage() {
    	cur_pos -= 5;
    	if (cur_pos < 0) cur_pos = 0;
    	getCandidateChars(pinyin, cur_pos, 5);
    }

    public void nextPage() {
    	cur_pos += 5;
    	if (getCandidateChars(pinyin, cur_pos, 5) <= 0) cur_pos -= 5;
    	if (cur_candidates[cur_sel] == 0) cur_sel = 0;
    }

    public void prevChar() {
    	cur_sel --;
    	if (cur_sel < 0) {
    		cur_pos -= 5;
    		if (cur_pos < 0) cur_pos = 0;
    		cur_sel = 4;
    		getCandidateChars(pinyin, cur_pos, 5);
    	}
    }

    public void nextChar() {
    	cur_sel ++;
    	if (cur_sel > 4) {
    		cur_pos += 5;
    		if (getCandidateChars(pinyin, cur_pos, 5) > 0) {
    			cur_sel = 0;
    		} else {
    			cur_pos -= 5;
    			cur_sel = 4;
    		}    		
    	} else if (cur_candidates[cur_sel] == 0) {
    	    cur_sel --;
    	}
    }

    public String getSelected() {
    	return new String(cur_candidates, cur_sel, 1);    	
    }

    public void reset() {
    	cur_pos = 0;
    	cur_sel = 0;
    	pinyin = ""; 	
    	for (int i = 0; i < 5; i++) {
    		cur_candidates[i] = 0;
    	}
    }

    /** shift.png */
    private static byte[] shift =
    { (byte)0x89, (byte)0x50, (byte)0x4e, (byte)0x47, (byte)0x0d, (byte)0x0a, (byte)0x1a, (byte)0x0a, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x0d, (byte)0x49, (byte)0x48, (byte)0x44, (byte)0x52, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x0d, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x0d, (byte)0x08, (byte)0x03, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x45, 
        (byte)0x35, (byte)0x14, (byte)0x4e, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x04, (byte)0x67, (byte)0x41, (byte)0x4d, 
        (byte)0x41, (byte)0x00, (byte)0x00, (byte)0xb1, (byte)0x8e, (byte)0x7c, (byte)0xfb, (byte)0x51, (byte)0x93, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x20, (byte)0x63, (byte)0x48, (byte)0x52, (byte)0x4d, (byte)0x00, (byte)0x00, (byte)0x7a, 
        (byte)0x25, (byte)0x00, (byte)0x00, (byte)0x80, (byte)0x83, (byte)0x00, (byte)0x00, (byte)0xf9, (byte)0xff, (byte)0x00, 
        (byte)0x00, (byte)0x80, (byte)0xe6, (byte)0x00, (byte)0x00, (byte)0x75, (byte)0x2e, (byte)0x00, (byte)0x00, (byte)0xea, 
        (byte)0x5f, (byte)0x00, (byte)0x00, (byte)0x3a, (byte)0x97, (byte)0x00, (byte)0x00, (byte)0x17, (byte)0x6f, (byte)0x69, 
        (byte)0xe4, (byte)0xc4, (byte)0x2b, (byte)0x00, (byte)0x00, (byte)0x03, (byte)0x00, (byte)0x50, (byte)0x4c, (byte)0x54, 
        (byte)0x45, (byte)0xe6, (byte)0xe6, (byte)0xe6, (byte)0xcc, (byte)0xcc, (byte)0xcc, (byte)0x7d, (byte)0x7d, (byte)0x7d, 
        (byte)0xff, (byte)0xff, (byte)0xff, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0xa0, 
        (byte)0xe5, (byte)0xcc, (byte)0x14, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x04, (byte)0x74, (byte)0x52, (byte)0x4e, 
        (byte)0x53, (byte)0xff, (byte)0xff, (byte)0xff, (byte)0x00, (byte)0x40, (byte)0x2a, (byte)0xa9, (byte)0xf4, (byte)0x00, 
        (byte)0x00, (byte)0x00, (byte)0x60, (byte)0x49, (byte)0x44, (byte)0x41, (byte)0x54, (byte)0x78, (byte)0x9c, (byte)0x62, 
        (byte)0x60, (byte)0x06, (byte)0x03, (byte)0x46, (byte)0x08, (byte)0x05, (byte)0x10, (byte)0x40, (byte)0x0c, (byte)0x10, 
        (byte)0x0e, (byte)0x03, (byte)0x13, (byte)0x98, (byte)0x06, (byte)0x08, (byte)0x20, (byte)0x06, (byte)0x08, (byte)0x87, 
        (byte)0x01, (byte)0xc2, (byte)0x05, (byte)0x08, (byte)0x20, (byte)0x06, (byte)0x28, (byte)0x07, (byte)0xc2, (byte)0x05, 
        (byte)0x08, (byte)0x20, (byte)0x06, (byte)0x18, (byte)0x07, (byte)0xcc, (byte)0x05, (byte)0x08, (byte)0x20, (byte)0x06, 
        (byte)0x38, (byte)0x07, (byte)0xc4, (byte)0x05, (byte)0x08, (byte)0x20, (byte)0x06, (byte)0x46, (byte)0x26, (byte)0x26, 
        (byte)0x26, (byte)0xb0, (byte)0x3e, (byte)0x10, (byte)0x00, (byte)0x08, (byte)0x20, (byte)0x54, (byte)0x53, (byte)0x00, 
        (byte)0x02, (byte)0x08, (byte)0x95, (byte)0x07, (byte)0x10, (byte)0x40, (byte)0xa8, (byte)0x3c, (byte)0x80, (byte)0x00, 
        (byte)0x42, (byte)0xe5, (byte)0x01, (byte)0x04, (byte)0x10, (byte)0x2a, (byte)0x0f, (byte)0x20, (byte)0x80, (byte)0x20, 
        (byte)0x3c, (byte)0x90, (byte)0x79, (byte)0x20, (byte)0x06, (byte)0x40, (byte)0x80, (byte)0x01, (byte)0x00, (byte)0x74, 
        (byte)0xd7, (byte)0x01, (byte)0x49, (byte)0x4a, (byte)0xc4, (byte)0x00, (byte)0x8f, (byte)0x00, (byte)0x00, (byte)0x00, 
        (byte)0x00, (byte)0x49, (byte)0x45, (byte)0x4e, (byte)0x44, (byte)0xae, (byte)0x42, (byte)0x60, (byte)0x82};

    static {
    	cnlib = new CNLib();
    	IMimage = Image.createImage(shift,0,shift.length);
    }


}
